<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="adminHpMapper">

	 <resultMap type="MainHp" id="adminHpResultMap">
	  	<id property="hpNo" column="HP_NO"/>
	  	<result property="rowNum" column="ROWNUM"/>
	  	<result property="hpName" column="HP_NAME"/>
	  	<result property="hpPhone" column="HP_PHONE"/>
	  	<result property="hpPostCode" column="HP_POSTCODE"/>
	  	<result property="hpAddress" column="HP_ADDRESS"/>
	  	<result property="hpx" column="HP_X"/>
	  	<result property="hpy" column="HP_Y"/>
	  	<result property="hpAvgRate" column="HP_AVG_RATE"/>
	  	<result property="hpReCount" column="HP_REVIEW"/>
	  	<result property="hpComment" column="HP_COMMENT"/>
	  	<result property="hpStatus" column="HP_STATUS"/>
	  	<result property="hpCateCode" column="HPCATE_CODE"/>
	  	<result property="hpCateName" column="HPCATE_NAME"/>
	  	<result property="drHpNo" column="DRHP_NO"/>
	  	<result property="originFileName" column="DRHP_ORIGIN"/>
	  	<result property="renameFileName" column="DRHP_RENAME"/>
	  	<result property="filePath" column="DRHP_FILEPATH"/>
	  	<result property="phCode" column="PH_CODE"/>
	  	<result property="hpDay" column="HP_DAY"/>
	  	<result property="hpOpenTime" column="HP_OPEN_TIME"/>
	  	<result property="hpCloseTime" column="HP_CLOSE_TIME"/>
  </resultMap>



	<!-- 일반 리스트 카운트 조회용 -->
	<select id="getListCount" resultType="_int">
		SELECT COUNT(*)
		FROM HOSPITAL
	</select>
	
	
	
	<!-- 전체리스트 조회용 -->
	<select id="selectAllList" resultMap="adminHpResultMap">
		SELECT ROWNUM, HP_NO, HP_NAME, HP_PHONE, HP_POSTCODE, HP_ADDRESS, HP_AVG_RATE, HP_REVIEW, HP_STATUS, HPCATE_NAME
		FROM(
			SELECT HP.HP_NO, HP.HP_NAME, HP.HP_PHONE, HP.HP_POSTCODE, HP.HP_ADDRESS, HP.HP_AVG_RATE, HP.HP_REVIEW, HP.HP_STATUS,
			LISTAGG(CAST(HG.HPCATE_NAME AS VARCHAR(100)),', ')WITHIN GROUP (ORDER BY NULL) AS HPCATE_NAME
            FROM HOSPITAL HP
                JOIN HPLIST HL ON (HP.HP_NO = HL.HP_NO)
                JOIN HPCATEGORY HG ON (HL.HPCATE_CODE = HG.HPCATE_CODE)
            GROUP BY HP.HP_NO, HP.HP_NAME, HP.HP_PHONE, HP.HP_POSTCODE, HP.HP_ADDRESS, HP.HP_AVG_RATE, HP.HP_REVIEW, HP.HP_STATUS
		)
	</select>


	
	<!-- 검색 리스트 카운트 -->
	<select id="selectSearchListCount" parameterType="adminHpSearch" resultType="_int">
		 SELECT COUNT(*)
		 FROM 
		 (
		 	SELECT HP.HP_NO, HP.HP_NAME, HP.HP_PHONE, HP.HP_POSTCODE, HP.HP_ADDRESS, HP.HP_AVG_RATE, HP.HP_REVIEW, HP.HP_STATUS,
			LISTAGG(CAST(HG.HPCATE_NAME AS VARCHAR(100)),', ')WITHIN GROUP (ORDER BY NULL) AS HPCATE_NAME
            FROM HOSPITAL HP
                JOIN HPLIST HL ON (HP.HP_NO = HL.HP_NO)
                JOIN HPCATEGORY HG ON (HL.HPCATE_CODE = HG.HPCATE_CODE)
            <where>
            <if test="hpNo != null and hpNo !=''">
            	AND HP.HP_NO=#{hpNo}
            </if>
            <if test="hpName != null and hpName !=''">
            	AND HP.HP_NAME LIKE '%' || #{hpName} || '%'
            </if>
            <if test="hpCateCode != null and hpCateCode !=''">
            	AND HG.HPCATE_CODE=#{hpCateCode}
            </if>
            <if test="hpCateName != null and hpCateName !=''">
            	AND HG.HPCATE_NAME LIKE '%' || #{hpCateName} || '%'
            </if>
            <if test="hpStatus != null and hpStatus !=''">
            	AND HP.STATUS=#{hpStatus}
            </if>
            </where>
                   
            GROUP BY HP.HP_NO, HP.HP_NAME, HP.HP_PHONE, HP.HP_POSTCODE, HP.HP_ADDRESS, HP.HP_AVG_RATE, HP.HP_REVIEW, HP.HP_STATUS
		 
		 )
	
	</select>
	


	<!-- 검색 리스트 조회용 -->
	<select id="selectSearchList" parameterType="adminHpSearch" resultMap="adminHpResultMap">
		SELECT ROWNUM, HP_NO, HP_NAME, HP_PHONE, HP_POSTCODE, HP_ADDRESS, HP_AVG_RATE, HP_REVIEW, HP_STATUS, HPCATE_NAME
		 FROM 
		 (
		 	SELECT HP.HP_NO, HP.HP_NAME, HP.HP_PHONE, HP.HP_POSTCODE, HP.HP_ADDRESS, HP.HP_AVG_RATE, HP.HP_REVIEW, HP.HP_STATUS,
			LISTAGG(CAST(HG.HPCATE_NAME AS VARCHAR(100)),', ')WITHIN GROUP (ORDER BY NULL) AS HPCATE_NAME
            FROM HOSPITAL HP
                JOIN HPLIST HL ON (HP.HP_NO = HL.HP_NO)
                JOIN HPCATEGORY HG ON (HL.HPCATE_CODE = HG.HPCATE_CODE)
            <where>
            <if test="hpNo != null and hpNo !=''">
            	AND HP.HP_NO=#{hpNo}
            </if>
            <if test="hpName != null and hpName !=''">
            	AND HP.HP_NAME LIKE '%' || #{hpName} || '%'
            </if>
            <if test="hpCateCode != null and hpCateCode !=''">
            	AND HG.HPCATE_CODE=#{hpCateCode}
            </if>
            <if test="hpCateName != null and hpCateName !=''">
            	AND HG.HPCATE_NAME LIKE '%' || #{hpCateName} || '%'
            </if>
            <if test="hpStatus != null and hpStatus !=''">
            	AND HP.STATUS=#{hpStatus}
            </if>
            </where>
                   
            GROUP BY HP.HP_NO, HP.HP_NAME, HP.HP_PHONE, HP.HP_POSTCODE, HP.HP_ADDRESS, HP.HP_AVG_RATE, HP.HP_REVIEW, HP.HP_STATUS
		 
		 )
	</select>

	



</mapper>